<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<title>Mapbox + RealtimeIRL (v3.6.1)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- 1️⃣ RealtimeIRL SDK -->
<script src="https://cdn.jsdelivr.net/npm/@rtirl/api"></script>

<!-- 2️⃣ Mapbox GL JS v3.6.1 (UMD) -->
<link href="https://api.mapbox.com/mapbox-gl-js/v3.6.1/mapbox-gl.css" rel="stylesheet">
<script src="https://api.mapbox.com/mapbox-gl-js/v3.6.1/mapbox-gl.js"></script>

<!-- 3️⃣ Mapbox Language 플러그인 -->
<script src="https://cdn.jsdelivr.net/npm/@mapbox/mapbox-gl-language@2/dist/mapboxgl-language.min.js"></script>

<style>
  html, body{margin:0;height:100%;overflow:hidden;}
  #map{width:100%;height:100%;}
</style>
</head>
<body>
<div id="map"></div>

<script>
// ────── API 키 설정
const MAPBOX_TOKEN = "pk.eyJ1IjoiaG9vbmNvbSIsImEiOiJjbWNjM3R4enUwM3pnMmlxMWJvZTVrMWIzIn0.h_-BNK4FuriEfFWXvE1pmw";
const PULL_KEY     = "zeoeyze9htbyx455";   // RealtimeIRL pull key

// ────── 지도를 초기화 (DOMContentLoaded 이후)
document.addEventListener("DOMContentLoaded", () => {
  mapboxgl.accessToken = MAPBOX_TOKEN;

  const map = new mapboxgl.Map({
    container: "map",
    style: "mapbox://styles/mapbox/streets-v12",
    center: [126.9780, 37.5665], // 서울시청
    zoom: 14,
  });

  // 한국어 언어 플러그인
  map.addControl(new MapboxLanguage({ defaultLanguage: "ko" }));

  // 커스텀 마커 (프로필 사진)
  const markerEl = document.createElement("div");
  markerEl.style.backgroundImage =
    'url("https://raw.githubusercontent.com/ljw2455qq/realtimeirl/main/profile.png")';
  markerEl.style.width = "25px";
  markerEl.style.height = "25px";
  markerEl.style.borderRadius = "50%";
  markerEl.style.border = "2px solid #fff";
  markerEl.style.boxShadow = "0 0 8px rgba(0,0,0,.6)";
  markerEl.style.backgroundSize = "cover";

  const marker = new mapboxgl.Marker(markerEl)
    .setLngLat([126.9780, 37.5665])
    .addTo(map);

  // RealtimeIRL 위치 이벤트
  RealtimeIRL.forPullKey(PULL_KEY).addLocationListener((loc) => {
    if (!loc.latitude || !loc.longitude) return;

    const lngLat = [loc.longitude, loc.latitude];
    marker.setLngLat(lngLat);
    map.flyTo({ center: lngLat, zoom: map.getZoom(), speed: 0.8, essential: true });
  });
});
</script>
</body>
</html>
