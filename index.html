<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <title>RealtimeIRL + Mapbox (v3.6.1)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- RealtimeIRL SDK -->
  <script src="https://cdn.jsdelivr.net/npm/@rtirl/api"></script>

  <!-- Mapbox GL JS v3.6.1 (UMD) -->
  <script src="https://api.mapbox.com/mapbox-gl-js/v3.6.1/mapbox-gl.js"></script>
  <link href="https://api.mapbox.com/mapbox-gl-js/v3.6.1/mapbox-gl.css" rel="stylesheet">

  <!-- Mapbox Language í”ŒëŸ¬ê·¸ì¸ (v2.x í˜¸í™˜ ë²„ì „) -->
  <script src="https://mapbox.github.io/mapbox-gl-language/index.js"></script>

  <style>
    body {
      margin:0;
      padding:0;
      background:transparent; /* OBS ì˜¤ë²„ë ˆì´ìš© íˆ¬ëª… ë°°ê²½ */
    }
    #map { width:100vw; height:100vh; }

    .mapboxgl-ctrl-logo,
    .mapboxgl-ctrl-attrib { display:none !important; } /* ë¡œê³ /ì €ì‘ê¶Œ ìˆ¨ê¹€ */
  </style>
</head>

<body>
<div id="map"></div>

<script>
  // ğŸ”‘ API Key ì…ë ¥
  const MAPBOX_TOKEN = "pk.eyJ1IjoiaG9vbmNvbSIsImEiOiJjbWNjM3R4enUwM3pnMmlxMWJvZTVrMWIzIn0.h_-BNK4FuriEfFWXvE1pmw";
  const PULL_KEY = "zeoeyze9htbyx455"; // ë³¸ì¸ RealtimeIRL pull key

  /* ==================== Mapbox GL JS ì´ˆê¸°í™” (v3.6.1) ==================== */
  mapboxgl.accessToken = MAPBOX_TOKEN;
  const map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/mapbox/streets-v12',   // ë””í…Œì¼ ì¢‹ì€ ìŠ¤íƒ€ì¼
    center: [126.9780, 37.5665],                  // ì´ˆê¸° ì¢Œí‘œ (ì„œìš¸ì‹œì²­)
    zoom: 14
  });

  /* ==================== ì–¸ì–´ ì„¤ì • (í•œêµ­ì–´) ==================== */
  map.addControl(new MapboxLanguage({ defaultLanguage: 'ko' }));

  /* ==================== í™•ëŒ€/ì¶•ì†Œ ì»¨íŠ¸ë¡¤ ë²„íŠ¼ ì¶”ê°€ ==================== */
  map.addControl(new mapboxgl.NavigationControl(), 'top-right');

  /* ==================== ì»¤ìŠ¤í…€ ë§ˆì»¤ (ë‚´ ì‚¬ì§„) ==================== */
  const el = document.createElement('div');
  el.style.backgroundImage = 'url("https://raw.githubusercontent.com/ljw2455qq/realtimeirl/main/profile.png")';
  el.style.width = '25px';            // ë§ˆì»¤ í¬ê¸°
  el.style.height = '25px';
  el.style.backgroundSize = 'cover';
  el.style.borderRadius = '50%';
  el.style.border = '2px solid white';
  el.style.boxShadow = '0 0 8px rgba(0,0,0,0.6)';

  const marker = new mapboxgl.Marker(el)
    .setLngLat([126.9780, 37.5665])   // ì´ˆê¸° ì„œìš¸ ì¢Œí‘œ
    .addTo(map);

  /* ==================== RealtimeIRL ì—°ê²° ==================== */
  RealtimeIRL.forPullKey(PULL_KEY).addLocationListener((location) => {
    console.log("ìƒˆ GPS ì¢Œí‘œ:", location);

    if (location.latitude && location.longitude) {
      // ë§ˆì»¤ ìœ„ì¹˜ ì—…ë°ì´íŠ¸
      marker.setLngLat([location.longitude, location.latitude]);

      // ì§€ë„ ì¤‘ì‹¬ ë¶€ë“œëŸ½ê²Œ ì´ë™
      map.flyTo({
        center: [location.longitude, location.latitude],
        essential: true,
        speed: 0.8,
        zoom: map.getZoom()   // í˜„ì¬ ì¤Œ ìœ ì§€
      });
    }
  });
</script>
</body>
</html>
