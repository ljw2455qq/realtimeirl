<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>GPS Overlay</title>
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.12.0/mapbox-gl.js"></script>
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.12.0/mapbox-gl.css" rel="stylesheet">
  <style>
    body, html { margin:0; padding:0; height:100%; }
    #map { width:100%; height:100%; }
  </style>
</head>
<body>
  <div id="map"></div>
  <script type="module">
    import { db, ref, onValue } from "./firebase.js";

    mapboxgl.accessToken = "pk.eyJ1IjoiaG9vbmNvbSIsImEiOiJjbWNjM3R4enUwM3pnMmlxMWJvZTVrMWIzIn0.h_-BNK4FuriEfFWXvE1pmw";

    const map = new mapboxgl.Map({
      container: 'map',
      style: 'mapbox://styles/mapbox/dark-v11',
      center: [126.9780, 37.5665], // 초기 좌표 (서울시청)
      zoom: 12
    });

    let marker = null;

    // Firebase에서 GPS 좌표 실시간 수신
    onValue(ref(db, 'gps/current'), (snapshot) => {
      const data = snapshot.val();
      if (data) {
        const coords = [data.lng, data.lat];

        if (!marker) {
          marker = new mapboxgl.Marker({ color: "red" })
            .setLngLat(coords)
            .addTo(map);
        } else {
          marker.setLngLat(coords);
        }

        // 지도 중심도 같이 이동
        map.flyTo({ center: coords, essential: true });
      }
    });
  </script>
</body>
</html>
