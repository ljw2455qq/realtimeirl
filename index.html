<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <title>RealtimeIRL + Mapbox (v3.6.1)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- RealtimeIRL SDK -->
  <script src="https://cdn.jsdelivr.net/npm/@rtirl/api"></script>

  <!-- Mapbox GL JS v3.6.1 (UMD) -->
  <script src="https://api.mapbox.com/mapbox-gl-js/v3.6.1/mapbox-gl.js"></script>
  <link href="https://api.mapbox.com/mapbox-gl-js/v3.6.1/mapbox-gl.css" rel="stylesheet">

  <!-- Mapbox Language 플러그인 (v2.x 호환 버전) -->
  <script src="https://mapbox.github.io/mapbox-gl-language/index.js"></script>

  <style>
    body {
      margin:0;
      padding:0;
      background:transparent; /* OBS 오버레이용 투명 배경 */
    }
    #map { width:100vw; height:100vh; }

    .mapboxgl-ctrl-logo,
    .mapboxgl-ctrl-attrib { display:none !important; } /* 로고/저작권 숨김 */
  </style>
</head>

<body>
<div id="map"></div>

<script>
  // 🔑 API Key 입력
  const MAPBOX_TOKEN = "pk.eyJ1IjoiaG9vbmNvbSIsImEiOiJjbWNjM3R4enUwM3pnMmlxMWJvZTVrMWIzIn0.h_-BNK4FuriEfFWXvE1pmw";
  const PULL_KEY = "zeoeyze9htbyx455"; // 본인 RealtimeIRL pull key

  /* ==================== Mapbox GL JS 초기화 (v3.6.1) ==================== */
  mapboxgl.accessToken = MAPBOX_TOKEN;
  const map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/mapbox/streets-v12',   // 디테일 좋은 스타일
    center: [126.9780, 37.5665],                  // 초기 좌표 (서울시청)
    zoom: 14
  });

  /* ==================== 언어 설정 (한국어) ==================== */
  map.addControl(new MapboxLanguage({ defaultLanguage: 'ko' }));

  /* ==================== 확대/축소 컨트롤 버튼 추가 ==================== */
  map.addControl(new mapboxgl.NavigationControl(), 'top-right');

  /* ==================== 커스텀 마커 (내 사진) ==================== */
  const el = document.createElement('div');
  el.style.backgroundImage = 'url("https://raw.githubusercontent.com/ljw2455qq/realtimeirl/main/profile.png")';
  el.style.width = '25px';            // 마커 크기
  el.style.height = '25px';
  el.style.backgroundSize = 'cover';
  el.style.borderRadius = '50%';
  el.style.border = '2px solid white';
  el.style.boxShadow = '0 0 8px rgba(0,0,0,0.6)';

  const marker = new mapboxgl.Marker(el)
    .setLngLat([126.9780, 37.5665])   // 초기 서울 좌표
    .addTo(map);

  /* ==================== RealtimeIRL 연결 ==================== */
  RealtimeIRL.forPullKey(PULL_KEY).addLocationListener((location) => {
    console.log("새 GPS 좌표:", location);

    if (location.latitude && location.longitude) {
      // 마커 위치 업데이트
      marker.setLngLat([location.longitude, location.latitude]);

      // 지도 중심 부드럽게 이동
      map.flyTo({
        center: [location.longitude, location.latitude],
        essential: true,
        speed: 0.8,
        zoom: map.getZoom()   // 현재 줌 유지
      });
    }
  });
</script>
</body>
</html>
